<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Pencarian Al-Qur'an</title>
  <style>
    body { font-family:sans-serif; max-width:700px; margin:auto; padding:2em; }
    input, button { padding:0.5em; font-size:1em; }
    .result { margin-top: 1em; padding: 1em; background: #f9f9f9; border-radius: 8px; }
    .ayah { direction: rtl; font-size: 1.5em; margin-top: 0.5em; }
    .meta { font-size: 0.95em; color: #444; }
    a { text-decoration: none; color: #007b8a; }
  </style>
</head>
<body>

  <h2>Cari Kata dalam Al-Qur'an</h2>
  <input type="text" id="query" placeholder="Contoh: ÿßŸÑÿ±ÿ≠ŸÖŸÜ, kasih sayang" />
  <button onclick="searchQuran()">Cari</button>

  <div id="results"></div>

  <script>
    // Tentukan base URL otomatis
    const base = window.location.hostname.includes("netlify")
      ? "https://tadabbur.netlify.app"
      : "https://dickymiswardi.github.io/tadabbur";

    async function searchQuran() {
      const q = document.getElementById('query').value.trim();
      const resDiv = document.getElementById('results');
      resDiv.innerHTML = '';

      if (!q) return resDiv.textContent = '‚ùó Masukkan kata pencarian.';

      resDiv.innerHTML = 'üîç Sedang mencari...';

      try {
        const res = await fetch(`https://api.alquran.cloud/v1/search/${encodeURIComponent(q)}/all/ar`);
        const json = await res.json();

        if (!json.data?.matches || json.data.matches.length === 0) {
          resDiv.innerHTML = '‚ùå Tidak ditemukan.';
          return;
        }

        const seen = new Set();
        const output = json.data.matches.filter(m => {
          const key = `${m.surah.number}:${m.numberInSurah}`;
          if (seen.has(key)) return false;
          seen.add(key);
          return true;
        });

        resDiv.innerHTML = output.slice(0, 20).map(match => {
          const surah = match.surah.number;
          const name = match.surah.name;
          const ayat = match.numberInSurah;
          const url = `${base}/?surah=${surah}&ayat=${ayat}`;
          return `
            <div class="result">
              <div class="meta">üìñ <a href="${url}" target="_blank">${name} (${surah}:${ayat})</a></div>
              <div class="ayah">${match.text}</div>
            </div>
          `;
        }).join('');

      } catch (err) {
        console.error(err);
        resDiv.innerHTML = '‚ùå Gagal memuat data.';
      }
    }
  </script>

</body>
</html>
